steps:
# 1. Construir a imagem Docker
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-f', 'Dockerfile', '-t', 'gcr.io/ventros-gcp/health-pg', '.']

# 2. Enviar a imagem para o Container Registry
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/ventros-gcp/health-pg']

# 3. Implantar no Cloud Run
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'gcloud'
  args: ['run', 'deploy', 'flask-health-pg',
         '--image', 'gcr.io/ventros-gcp/health-pg',
         '--platform', 'managed', 
         '--region', 'southamerica-east1', 
         '--allow-unauthenticated',
         '--set-cloudsql-instances=ventros-gcp:southamerica-east1:pg-prod',
         '--set-secrets', 'CREDENTIALS_BACKEND_DB_PROD=CREDENTIALS_BACKEND_DB_PROD:1',
         '--set-env-vars', 'DB_USER1=flask']
#         '--set-env-vars', 'DB_USER=flask,DB_PASS=flask-password,DB_NAME=flask-health-test,INSTANCE_UNIX_SOCKET=/cloudsql/ventros-gcp:southamerica-east1:pg-prod']
